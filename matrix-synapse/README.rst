
========
 README
========

Generating dependencies for `matrix-synapse` is a bit tricky.


First of all, it needs Python 2.7, so when entering the shell with the tools,
use the following command::

  nix-shell --argstr pythonPackages python27Packages


`pip-compile` depends already on `cffi` being present, run it with the following
command::

  nix-shell -p pythonPackages.cffi --command pip-compile

Manually tweak the generated file `requirements.txt`, the first entry has to be
changed because `pip2nix` cannot yet deal with editable installs. The head
should look as follows::

  #
  # This file is autogenerated by pip-compile
  # To update, run:
  #
  #    pip-compile --output-file requirements.txt requirements.in
  #
  # -e git+git://github.com/matrix-org/synapse.git@v0.25.1#egg=matrix-synapse
  https://github.com/matrix-org/synapse/archive/v0.25.1.tar.gz#egg=matrix-synapse
  affinity==0.1.0


Finally freeze the requirements into Nix derivations::

  nix-shell -p python27Packages.cffi \
      --command 'pip2nix generate . -r requirements.txt -c constraints.txt'
